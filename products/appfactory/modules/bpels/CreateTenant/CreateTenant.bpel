<!-- CreateTenant BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Mon Mar 05 12:13:11 IST 2012 -->
<bpel:process name="CreateTenant"
         targetNamespace="http://wso2.org/bps/sample"
         suppressJoinFailure="yes"
         xmlns:tns="http://wso2.org/bps/sample"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns="http://services.mgt.tenant.carbon.wso2.org" xmlns:xsd="http://beans.common.stratos.carbon.wso2.org/xsd" xmlns:ns0="http://services.core.appfactory.carbon.wso2.org" xmlns:ns1="http://services.mgt.tenant.appfactory.carbon.wso2.org">

    <!-- Import the client WSDL -->
    <bpel:import namespace="http://services.mgt.tenant.appfactory.carbon.wso2.org" location="AppFactoryTenantMgtAdminService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://services.core.appfactory.carbon.wso2.org" location="AppFactoryTenantToolInitializerService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://services.mgt.tenant.carbon.wso2.org" location="TenantMgtAdminService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import location="CreateTenantArtifacts.wsdl" namespace="http://wso2.org/bps/sample" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:CreateTenant"
                     myRole="CreateTenantProvider"
                     />
        
        <bpel:partnerLink name="TenantMgtAdminServicePL" partnerLinkType="tns:TenantMgtAdminServicePLT" partnerRole="TenantMgtAdminServiceProvider"></bpel:partnerLink>
        <bpel:partnerLink name="AppFactoryTenantToolInitializerServicePL" partnerLinkType="tns:AppFactoryTenantToolInitializerServicePLT" partnerRole="AppFactoryTenantToolInitializerServicePLProvider"></bpel:partnerLink>
        <bpel:partnerLink name="dev-cloud-create-tenant" partnerLinkType="tns:TenantMgtAdminServicePLT" partnerRole="TenantMgtAdminServiceProvider"></bpel:partnerLink>
        <bpel:partnerLink name="test-cloud-create-tenant" partnerLinkType="tns:TenantMgtAdminServicePLT" partnerRole="TenantMgtAdminServiceProvider"></bpel:partnerLink>
        <bpel:partnerLink name="staging-cloud-create-tenant" partnerLinkType="tns:TenantMgtAdminServicePLT" partnerRole="TenantMgtAdminServiceProvider"></bpel:partnerLink>
        <bpel:partnerLink name="prod-cloud-create-tenant" partnerLinkType="tns:TenantMgtAdminServicePLT" partnerRole="TenantMgtAdminServiceProvider"></bpel:partnerLink>
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:CreateTenantRequestMessage"/>
                  
        <!-- 
          Reference to the message that will be returned to the requester
          -->
        <bpel:variable name="output"
                  messageType="tns:CreateTenantResponseMessage"/>
        <bpel:variable name="TenantMgtAdminServicePLResponse" messageType="ns:addTenantResponse"></bpel:variable>
        <bpel:variable name="TenantMgtAdminServicePLRequest" messageType="ns:addTenantRequest"></bpel:variable>
        <bpel:variable name="AppFactoryTenantToolInitializerServicePLResponse" messageType="ns0:initializeRepositoryManagerResponse"></bpel:variable>
        <bpel:variable name="AppFactoryTenantToolInitializerServicePLRequest" messageType="ns0:initializeRepositoryManagerRequest"></bpel:variable>
        <bpel:variable name="AppFactoryTenantToolInitializerServicePLResponse1" messageType="ns0:initializeBuildManagerResponse"></bpel:variable>
        <bpel:variable name="AppFactoryTenantToolInitializerServicePLRequest1" messageType="ns0:initializeBuildManagerRequest"></bpel:variable>
        <bpel:variable name="AppFactoryTenantMgtAdminServicePLResponse" messageType="ns1:doPostTenantActivationResponse"></bpel:variable>
        <bpel:variable name="AppFactoryTenantMgtAdminServicePLRequest" messageType="ns1:doPostTenantActivationRequest"></bpel:variable>
        <bpel:variable name="TenantMgtAdminServicePLResponse1" messageType="ns:activateTenantResponse"></bpel:variable>
        <bpel:variable name="TenantMgtAdminServicePLRequest1" messageType="ns:activateTenantRequest"></bpel:variable>
        <bpel:variable name="dev-cloud-create-tenantResponse" messageType="ns:addSkeletonTenantResponse"></bpel:variable>
        <bpel:variable name="dev-cloud-create-tenantRequest" messageType="ns:addSkeletonTenantRequest"></bpel:variable>
        <bpel:variable name="test-cloud-create-tenantResponse" messageType="ns:addSkeletonTenantResponse"></bpel:variable>
        <bpel:variable name="test-cloud-create-tenantRequest" messageType="ns:addSkeletonTenantRequest"></bpel:variable>
        <bpel:variable name="staging-cloud-create-tenantResponse" messageType="ns:addSkeletonTenantResponse"></bpel:variable>
        <bpel:variable name="staging-cloud-create-tenantRequest" messageType="ns:addSkeletonTenantRequest"></bpel:variable>
        <bpel:variable name="prod-cloud-create-tenantResponse" messageType="ns:addSkeletonTenantResponse"></bpel:variable>
        <bpel:variable name="prod-cloud-create-tenantRequest" messageType="ns:addSkeletonTenantRequest"></bpel:variable>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:sequence name="main">
        
        <!-- Receive input from requester. 
             Note: This maps to operation defined in CreateTenant.wsdl 
             -->
        <bpel:sequence name="Sequence">
            <bpel:receive name="receiveInput" partnerLink="client" portType="tns:CreateTenant" operation="process" variable="input" createInstance="yes" />
            <bpel:assign validate="no" name="Assign-CreateTenantRequest"><bpel:copy>
                <bpel:from>
                    <bpel:literal>
                    <ns:addTenant
							xmlns:ns="http://services.mgt.tenant.carbon.wso2.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<ns:tenantInfoBean>
								<xsd:active>true</xsd:active>
								<xsd:admin>admin</xsd:admin>
								<xsd:adminPassword>adminPassword</xsd:adminPassword>
								<xsd:createdDate>2001-12-31T12:00:00</xsd:createdDate>
								<xsd:email>email</xsd:email>
								<xsd:firstname>firstname</xsd:firstname>
								<xsd:lastname>lastname</xsd:lastname>
								<xsd:originatedService>originatedService</xsd:originatedService>
								<xsd:successKey>successKey</xsd:successKey>
								<xsd:tenantDomain>tenantDomain</xsd:tenantDomain>
								<xsd:tenantId>0</xsd:tenantId>
								<xsd:usagePlan>usagePlan</xsd:usagePlan>
							</ns:tenantInfoBean>
						</ns:addTenant>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="TenantMgtAdminServicePLRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:admin]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:admin]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:firstName]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:firstname]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:lastName]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:lastname]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:adminPassword]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:adminPassword]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:tenantDomain]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:email]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:email]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:active]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:active]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:successKey]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:successKey]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:createdDate]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:createdDate]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:originatedService]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:originatedService]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:usagePlan]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantInfoBean/xsd:usagePlan]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
            </bpel:assign>
            <bpel:invoke name="Invoke-CreateTenantInAppFactory" partnerLink="TenantMgtAdminServicePL" operation="addTenant" portType="ns:TenantMgtAdminServicePortType" inputVariable="TenantMgtAdminServicePLRequest" outputVariable="TenantMgtAdminServicePLResponse"></bpel:invoke>
            <bpel:assign validate="no" name="Assign-ActivateTenantRequest"><bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <ns:activateTenant xmlns:ns="http://services.mgt.tenant.carbon.wso2.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><ns:tenantDomain>ns:tenantDomain</ns:tenantDomain>

                        </ns:activateTenant>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="TenantMgtAdminServicePLRequest1" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="TenantMgtAdminServicePLRequest1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:tenantDomain]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
            </bpel:assign>
            <bpel:invoke name="Invoke-ActivateTenantInAppFactory" partnerLink="TenantMgtAdminServicePL" operation="activateTenant" portType="ns:TenantMgtAdminServicePortType" inputVariable="TenantMgtAdminServicePLRequest1" outputVariable="TenantMgtAdminServicePLResponse1"></bpel:invoke>
            <bpel:assign validate="no" name="Assign-initializeRepositoryManagerRequest"><bpel:copy>
                <bpel:from>
                    <bpel:literal xml:space="preserve"><ns:initializeRepositoryManager xmlns:ns="http://services.core.appfactory.carbon.wso2.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<ns:tenantDomain>ns:tenantDomain</ns:tenantDomain>
  <ns:usagePlan>ns:usagePlan</ns:usagePlan>
</ns:initializeRepositoryManager></bpel:literal>
                </bpel:from>
                <bpel:to variable="AppFactoryTenantToolInitializerServicePLRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="AppFactoryTenantToolInitializerServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:tenantDomain]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:usagePlan]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="AppFactoryTenantToolInitializerServicePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:usagePlan]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
            </bpel:assign>
            <bpel:invoke name="Invoke-initializeRepositoryManagerService" partnerLink="AppFactoryTenantToolInitializerServicePL" operation="initializeRepositoryManager" portType="ns0:AppFactoryTenantToolInitializerServicePortType" inputVariable="AppFactoryTenantToolInitializerServicePLRequest" outputVariable="AppFactoryTenantToolInitializerServicePLResponse"></bpel:invoke>
            <bpel:assign validate="no" name="Assign-initializeBuildManagerServiceRequest"><bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <ns:initializeBuildManager xmlns:ns="http://services.core.appfactory.carbon.wso2.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><ns:tenantDomain>ns:tenantDomain</ns:tenantDomain>
  <ns:usagePlan>ns:usagePlan</ns:usagePlan>

                        </ns:initializeBuildManager>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="AppFactoryTenantToolInitializerServicePLRequest1" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="AppFactoryTenantToolInitializerServicePLRequest1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:tenantDomain]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:usagePlan]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="AppFactoryTenantToolInitializerServicePLRequest1">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:usagePlan]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
            </bpel:assign>
            <bpel:invoke name="Invoke-initializeBuildManagerService" partnerLink="AppFactoryTenantToolInitializerServicePL" operation="initializeBuildManager" portType="ns0:AppFactoryTenantToolInitializerServicePortType" inputVariable="AppFactoryTenantToolInitializerServicePLRequest1" outputVariable="AppFactoryTenantToolInitializerServicePLResponse1"></bpel:invoke>
            
            
            
            <bpel:assign validate="no" name="Assign-result"><bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <tns:CreateTenantResponse xmlns:tns="http://wso2.org/bps/sample" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tns:result>tns:result</tns:result>

                        </tns:CreateTenantResponse>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="output" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="TenantMgtAdminServicePLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:return]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:result]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        
            </bpel:assign>
            <bpel:reply name="replyOutput" partnerLink="client" portType="tns:CreateTenant" operation="process" variable="output" />
        </bpel:sequence>
        
        
        
        
        <!-- Generate reply to synchronous request -->
        
        
        
        
        
        
        
        
        
        
        
    </bpel:sequence>
</bpel:process>

